<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf--8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>TITLE CRAFT — by Genial Design</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0b0d12; --panel:#101522e6; --card:#0e1423cc;
      --muted:#9aa7bd; --text:#e8edf6; --text-weak:#c7d0dd;
      --brand:#86a0ff; --brand-2:#6ee7ff; --ok:#67f3a2; --warn:#ffb85c; --err:#ff6b6b;
      --gold:#ffd76a; --gold2:#ffefb0;
      --glass: blur(12px) saturate(140%); --r-lg:18px; --r-sm:14px; --gap:16px; --tap:44px;
      
      --mouse-x: 50%; --mouse-y: 50%;
      --shadow: 0 16px 40px rgba(0,0,0,.5), 0 0 12px color-mix(in srgb, var(--brand) 15%, transparent);
      --focus: 0 0 0 3px color-mix(in srgb, var(--brand) 35%, transparent);
      --ease-out: cubic-bezier(.2, .8, .2, 1);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --panel:#ffffffee; --card:#ffffffee; --text:#0a0d14; --text-weak:#1b2230; --muted:#475569; --shadow:0 8px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.6); }
    }
    *{box-sizing:border-box} html,body{height:100%;-webkit-tap-highlight-color: transparent;}
    body{
      margin:0;
      background:
        radial-gradient(800px circle at var(--mouse-x) var(--mouse-y), color-mix(in srgb, var(--brand) 15%, transparent) 0%, transparent 40%),
        radial-gradient(1200px 800px at 85% -10%, #172033 0%, transparent 64%),
        radial-gradient(1200px 800px at -10% 120%, #111a2b 0%, transparent 55%),
        var(--bg);
      color:var(--text); font:500 16px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "SF Pro Text", Arial;
      overflow-x:hidden;
      transition: background .3s linear;
    }

    /* ===== PAGE LOADER ===== */
    #pageloader{
      position:fixed; inset:0; background:
        radial-gradient(1000px 800px at 50% -10%, #15203a 0%, transparent 60%),
        radial-gradient(900px 700px at 20% 120%, #0f1730 0%, transparent 60%),
        #0b0d12;
      z-index:9999; display:grid; place-items:center;
      transition: opacity .42s var(--ease-out), visibility .42s var(--ease-out);
    }
    #pageloader.hidden{ opacity:0; visibility:hidden }
    .pl-card{ text-align:center }
    .pl-logo{
      width:68px; height:68px; border-radius:16px; object-fit:cover;
      box-shadow:0 10px 30px rgba(124,147,255,.45), 0 0 24px rgba(110,231,255,.25);
      border:1px solid rgba(255,255,255,.15);
      animation: plGlow 1.6s ease-in-out infinite alternate;
    }
    @keyframes plGlow{ from{ filter: drop-shadow(0 0 0 rgba(134,160,255,.0)) } to{ filter: drop-shadow(0 0 16px rgba(134,160,255,.45)) } }
    .pl-bar{
      margin-top:16px; width:240px; height:6px; border-radius:999px; background:#10182b; overflow:hidden; border:1px solid #22345a;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 6px 18px rgba(0,0,0,.25)
    }
    .pl-bar > span{
      display:block; height:100%; width:0%; background:linear-gradient(90deg,#6ee7ff,#86a0ff,#6ee7ff);
      animation: loadline 1.84s ease forwards; box-shadow:0 0 16px rgba(110,231,255,.35)
    }
    @keyframes loadline{ 0%{width:0%} 60%{width:82%} 100%{width:100%} }

    .app{ max-width:1180px; margin-inline:auto; padding:18px 14px 24px; }
    header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px; }
    .brand{ display:flex; align-items:center; gap:12px; }
    .brand .logo{ width:40px; height:40px; border-radius:10px; display:block; object-fit:cover; background:none; box-shadow:0 8px 22px rgba(124,147,255,.35); border:1px solid rgba(255,255,255,.12); transition: transform .3s var(--ease-out); }
    .brand:hover .logo{ transform: rotate(-10deg) scale(1.1); }
    .brand h1{ margin:0; font-size: clamp(22px, 5vw, 26px); font-weight:900; letter-spacing:1px }
    .brand h1 .main{
      display:block; letter-spacing:1.2px; text-transform:uppercase;
      background: linear-gradient(90deg, #e8edf6, #c7d0dd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: all .3s ease;
    }
    .brand:hover h1 .main{
      background: linear-gradient(90deg, var(--brand-2), var(--brand));
      -webkit-background-clip: text;
    }
    .brand h1 .sub{ display:block; font-size:12px; font-weight:800; letter-spacing:.4px; color:var(--muted); margin-top:2px }

    .grid{ display:grid; grid-template-columns: 1fr; gap: var(--gap); }
    @media (min-width: 960px){ .grid{ grid-template-columns: 360px 1fr; } }
    
    .panel{
      background: var(--panel); backdrop-filter: var(--glass);
      border: 1px solid transparent;
      background-image: linear-gradient(var(--panel), var(--panel)),
                        radial-gradient(circle at top left, var(--brand), transparent 50%),
                        radial-gradient(circle at bottom right, var(--brand-2), transparent 50%);
      background-origin: border-box; background-clip: padding-box, border-box, border-box;
      border-radius: var(--r-lg); box-shadow: var(--shadow);
      transition: transform .4s var(--ease-out), box-shadow .4s var(--ease-out);
    }
    .inputs{ padding:12px } .results{ padding:12px }

    .cards{ display:flex; flex-direction:column; gap:12px }
    .card{ background: var(--card); border:1px solid rgba(255,255,255,.08); border-radius: var(--r-sm); padding:12px; }
    .card h3{ margin:0 0 8px; font-size:12px; letter-spacing:.3px; color:var(--text-weak); font-weight:800; text-transform:uppercase }
    .field{ display:flex; align-items:center; gap:8px; background:#0f1526; border:1px solid #1f2a44; border-radius:12px; padding:12px; transition: box-shadow .25s var(--ease-out) }
    textarea,input{ all:unset; color:var(--text); font:inherit; width:100%; caret-color: var(--brand); }
    .field:focus-within{ box-shadow: var(--focus) }

    .controls{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .ctrl{ background:#0f1526; border:1px solid #1f2a44; border-radius:12px; padding:10px; display:flex; align-items:center; justify-content:space-between; gap:8px }
    .ctrl label{ font-size:13px; color:var(--text-weak) }
    .ctrl input[type="number"]{ all:unset; width:72px; text-align:center; background:#0b1221; border:1px solid #1b2847; border-radius:10px; padding:8px 10px; font-weight:800 }
    
    .checks{ display:flex; gap:10px; flex-wrap:wrap }
    .check{
      display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:14px;
      background:#0f1526; border:2px solid #253456; transition:.35s var(--ease-out);
      min-height:48px; user-select:none; position:relative; overflow:hidden;
    }
    .check input{ width:20px; height:20px; accent-color: var(--brand); cursor:pointer; }
    .check .tag{ font-weight:800; letter-spacing:.3px }
    .check .state{
      font-size:11px; padding:4px 8px; border-radius:999px; background:#1a2240; border:1px solid #2a3a5f; color:#cfe3ff
    }
    .check:has(input:checked){
      background: linear-gradient(180deg, rgba(134,160,255,.12), rgba(110,231,255,.08));
      border-color: color-mix(in srgb, var(--ok) 50%, #253456);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--ok) 22%, transparent);
    }
    .check:has(input:not(:checked)){
      border-color: color-mix(in srgb, var(--err) 35%, #253456);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--err) 18%, transparent);
    }
    .check:has(input:not(:checked)) .state.data-off::before{ content:attr(data-off) }
    .check:has(input:checked) .state.data-on::before{ content:attr(data-on) }

    .btn{
      --h: 52px; display:inline-flex; align-items:center; justify-content:center; gap:10px;
      height:var(--h); width:100%; border-radius: calc(var(--h)/2);
      border:1px solid rgba(255,255,255,.09); color:#0a0d14; font-weight:900; letter-spacing:.3px;
      background: radial-gradient(120% 180% at 50% 0%, #c9d0ff, #86a0ff 55%, #6ee7ff 100%);
      box-shadow: 0 10px 34px rgba(124,147,255,.45), inset 0 1px 0 rgba(255,255,255,.75), 0 0 24px rgba(110,231,255,.25);
      cursor:pointer; user-select:none; position:relative; overflow:hidden;
      transition: transform .2s var(--ease-out), box-shadow .25s var(--ease-out), filter .2s var(--ease-out);
    }
    .btn::before { /* Glint effect for desktop */
        content: ""; position: absolute; top: 0; left: -100%; width: 75%; height: 100%;
        background: linear-gradient(110deg, transparent, rgba(255,255,255,.6), transparent);
        transform: skewX(-25deg); transition: left .65s var(--ease-out);
    }
    @media (hover: hover) { /* Apply hover effects only on devices that support hover */
      .btn:hover::before { left: 150%; }
      .btn:hover{ transform: translateY(-2px) scale(1.02); box-shadow: 0 14px 40px rgba(124,147,255,.55), inset 0 1px 0 rgba(255,255,255,.75), 0 0 30px rgba(110,231,255,.35); }
    }
    .btn:active{ transform: translateY(0) scale(.98) }
    .btn .spark{ width:18px; height:18px; fill:#0a0d14; filter: drop-shadow(0 0 3px rgba(255,255,255,.65)) }
    .btn .btn-text{ display:inline-flex; align-items:center; gap:4px; z-index: 1; }
    .dots{ display:inline-block; width:24px; text-align:left }
    .dots::after{ content:""; display:inline-block; width:1ch; animation: dots 1.2s steps(3,end) infinite }
    @keyframes dots{ 0%{content:""} 33%{content:"."} 66%{content:".."} 100%{content:"..."} }

    .session{
      padding:0; border:1px solid rgba(255,255,255,.10); border-radius:16px;
      background:linear-gradient(180deg, #0f1420cc, #0b0f1acc);
      margin:18px 0; box-shadow: 0 14px 28px rgba(0,0,0,.35); overflow:hidden;
      transition: box-shadow .25s var(--ease-out), transform .2s var(--ease-out);
    }
    .session-head{
      display:flex; align-items:center; justify-content:flex-end; gap:8px; padding:8px;
      background:linear-gradient(180deg,#0e1423,#0b1020);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .iconbtn{
      width:34px; height:34px; border-radius:10px; display:grid; place-items:center;
      background:#0d1526; border:1px solid #223456; color:#cfe3ff; cursor:pointer;
      transition:.2s var(--ease-out); user-select:none;
    }
    @media (hover: hover) {
        .iconbtn:hover{ transform: translateY(-1px) scale(1.1); background: #141f38; }
    }
    .iconbtn:active{ transform: translateY(0) scale(.98); background: #141f38;}
    .iconbtn svg{ width:16px; height:16px; fill:#cfe3ff }
    
    .audience{
      color:var(--text); background:linear-gradient(180deg,#0f1528,#0c1222);
      border-radius:14px; padding:12px; margin:12px; font-size:14px; position:relative;
      border:1px solid #2a3a5f; box-shadow: 0 0 0 3px rgba(134,160,255,.10);
      opacity: 0; transform: translateY(10px);
      transition: opacity .5s var(--ease-out), transform .5s var(--ease-out);
    }
    .audience.visible { opacity: 1; transform: translateY(0); }
    .audience::before{
      content:attr(data-label); position:absolute; top:-10px; left:12px; font-size:11px; padding:4px 8px; border-radius:999px;
      background:linear-gradient(90deg,#86a0ff33,#6ee7ff33); color:#eaf2ff; border:1px solid #3a4f87; font-weight:900; letter-spacing:.3px
    }

    .list{ display:flex; flex-direction:column; gap:12px; padding:0 12px 12px 12px }
    .session.collapsed .audience, .session.collapsed .list{
      max-height:0; opacity:0; overflow:hidden; padding-top:0; padding-bottom:0; margin:0 12px; border-width:0;
      transition: max-height .35s ease, opacity .25s ease, padding .35s ease, margin .35s ease, border-width .35s ease;
    }
    .session:not(.collapsed) .audience, .session:not(.collapsed) .list{
      transition: max-height .45s ease, opacity .35s ease, padding .45s ease, margin .45s ease;
    }

    .row{
      position:relative; display:block;
      background:#0b1221; border:1px solid #1b2847; border-radius:14px; padding:14px 12px 12px 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,.25);
      opacity: 0; transform: translateY(15px);
      transition: opacity .5s var(--ease-out), transform .5s var(--ease-out);
    }
    .row.visible { opacity: 1; transform: translateY(0); }
    .row.top{
      border-color: transparent;
      background-image:
        linear-gradient(#0b1221,#0b1221),
        radial-gradient(150px 60px at 18px 18px, #ffe38d70, transparent 60%),
        linear-gradient(120deg, #ffec9a, #ffd86a);
      background-origin: padding-box, border-box, border-box; background-clip: padding-box, padding-box, border-box;
      box-shadow: 0 0 0 4px rgba(255,231,150,.20), 0 10px 28px rgba(255,231,150,.12);
    }
    .row.top .txt{
      background: linear-gradient(90deg, var(--gold2), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: none; /* remove shimmer for top picks */
    }
    .badge{
      position:absolute; top:8px; left:8px;
      min-width:28px; height:28px; border-radius:8px; display:grid; place-items:center;
      font-weight:900; color:#cfe3ff; background:linear-gradient(180deg,#233153,#121b2f); border:1px solid #2a3a5f;
      box-shadow:0 4px 10px rgba(0,0,0,.25)
    }
    .star{ position:absolute; top:8px; left:42px; font-size:14px; color:#ffd76a; }

    .pair{ display:flex; flex-direction:column; gap:10px; margin-top:16px }
    .line{ display:grid; grid-template-columns: 1fr; gap:6px; padding:8px 10px; border-radius:12px; background:#0e172a; border:1px dashed #203156 }
    .label{ font-size:12px; color:#a9b7d0; letter-spacing:.2px; font-weight:800 }
    .txt{
      color:var(--text); word-break:break-word; font-size:15px; line-height:1.45;
      cursor:pointer; border-radius:10px; padding:6px 8px; position:relative; outline:none;
      background: linear-gradient(90deg, rgba(255,255,255,.03), rgba(255,255,255,.08), rgba(255,255,255,.03));
      background-size: 200% 100%; animation: shimmer 3.2s linear infinite;
      transition: box-shadow .25s var(--ease-out), transform .1s var(--ease-out);
    }
    .txt:active{ transform: scale(.98) }

    .tools{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; margin:6px 0 10px }
    .chip{ height:36px; padding:0 12px; border-radius:12px; background:#0e1627; border:1px solid #2a3a5f; color:#d6e4ff; font-weight:800; cursor:pointer }
    .chip.danger{ border-color:#5f2a2a; background:#1a0f12; color:#ffc7c7 }
    .chip:active{ transform: translateY(1px) }

    .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%) translateY(16px); background:linear-gradient(90deg,#20df92,#6ee7ff); color:#03141a; font-weight:900; font-size:12px; padding:10px 14px; border-radius:999px; box-shadow: 0 10px 24px rgba(110,231,255,.25); opacity:0; pointer-events:none; z-index:9999 }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0); transition:.25s var(--ease-out) }

    .skeleton{ border:1px dashed #263a6b; background:#0b1020; border-radius:12px; padding:12px; position:relative }
    .pulse{ height:12px; margin:8px 0; border-radius:6px; background: linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.12), rgba(255,255,255,.05)); background-size:200% 100%; animation: shimmerQuick 1.1s linear infinite }
    .sk-close{ position:absolute; right:8px; top:8px }
    .sr-only{ position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; clip-path: inset(50%) }
    :focus-visible{ outline: 3px solid color-mix(in srgb, var(--brand) 50%, transparent); outline-offset:2px }
    @keyframes shimmer{ to{ background-position:-200% 0 } }
    @keyframes shimmerQuick{ to{ background-position:-200% 0 } }
  </style>
</head>
<body>
  <div id="pageloader" role="status" aria-live="polite" aria-label="Loading">
    <div class="pl-card">
      <img class="pl-logo" src="https://i.imgur.com/Q7CqyWC.jpeg" alt="TITLE CRAFT logo" width="68" height="68" />
      <div class="pl-bar"><span></span></div>
    </div>
  </div>

  <div class="app" aria-hidden="true" id="appRoot">
    <header>
      <div class="brand">
        <img class="logo" src="https://i.imgur.com/Q7CqyWC.jpeg" alt="TITLE CRAFT logo" width="40" height="40" decoding="async" loading="lazy" />
        <h1>
          <span class="main">TITLE CRAFT</span>
          <span class="sub">by Genial Design</span>
        </h1>
      </div>
    </header>

    <div class="grid">
      <section class="panel inputs" aria-labelledby="inputs-title">
        <h2 id="inputs-title" class="sr-only">Inputs</h2>
        <div class="cards">
          <div class="card">
            <h3 data-i18n="videoTopic">Video topic <span class="req" aria-hidden="true">*</span></h3>
            <div class="field"><textarea id="topic" rows="3" data-i18n-placeholder="topicPlaceholder" placeholder="What's the video about?" aria-required="true"></textarea></div>
          </div>
          <div class="card">
            <h3 data-i18n="format">Format (optional)</h3>
            <div class="field"><input id="format" data-i18n-placeholder="formatPlaceholder" placeholder="Documentary, Review, Investigation..." /></div>
          </div>
          <div class="card">
            <h3 data-i18n="targetAudience">Target audience (optional)</h3>
            <div class="field"><input id="audience" data-i18n-placeholder="audiencePlaceholder" placeholder="Niche, age range, region..." /></div>
          </div>

          <div class="card">
            <h3 data-i18n="componentsCount">Components & Count</h3>
            <div class="checks" role="group" aria-label="Components">
              <label class="check">
                <input type="checkbox" id="wantTitles" checked aria-describedby="titles-state" />
                <span class="tag" data-i18n="titles">Titles</span>
                <span id="titles-state" class="state data-on data-off" aria-hidden="true"></span>
              </label>
              <label class="check">
                <input type="checkbox" id="wantThumbs" checked aria-describedby="thumbs-state" />
                <span class="tag" data-i18n="thumbnailTexts">Thumbnail texts</span>
                <span id="thumbs-state" class="state data-on data-off" aria-hidden="true"></span>
              </label>
            </div>
            <div class="controls" style="margin-top:10px">
              <div class="ctrl">
                <label for="count" data-i18n="countLabel">Count (5–15)</label>
                <input  
  type="number"  
  id="count"  
  min="5"  
  max="15"  
  value="10"  
  inputmode="numeric"
  onblur="this.value = Math.min(15, Math.max(5, this.value || 5));"
/>
              </div>
            </div>
          </div>

          <button id="send" class="btn" aria-busy="false">
            <svg class="spark" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M12 2l1.8 4.6L18 8l-4.2 1.4L12 14l-1.8-4.6L6 8l4.2-1.4L12 2z"/></svg>
            <span class="btn-text" data-i18n="send">Send</span>
          </button>
        </div>
      </section>

      <section class="panel results" id="results-panel" aria-labelledby="results-title">
        <h2 id="results-title" class="sr-only">Results</h2>
        <div class="tools">
          <button class="chip danger" id="clear-history" data-i18n="clearHistory">🗑 Clear history</button>
          <button class="chip" id="copy-all-titles" data-i18n="copyAllTitles">⧉ Copy all titles</button>
          <button class="chip" id="copy-all-thumbs" data-i18n="copyAllThumbs">⧉ Copy all thumbnails</button>
        </div>
        <div id="stream"></div>
      </section>
    </div>
  </div>

  <div id="toast" class="toast" aria-hidden="true">Copied</div>

<script>
/* ================= TRANSLATIONS ================= */
const translations = {
  en: {
    videoTopic: 'Video topic <span class="req" aria-hidden="true">*</span>', topicPlaceholder: "What's the video about?", format: 'Format (optional)', formatPlaceholder: 'Documentary, Review, Investigation...', targetAudience: 'Target audience (optional)', audiencePlaceholder: 'Niche, age range, region...', componentsCount: 'Components & Count', titles: 'Titles', thumbnailTexts: 'Thumbnail texts', countLabel: 'Count (5–15)', send: 'Send', clearHistory: '🗑 Clear history', copyAllTitles: '⧉ Copy all titles', copyAllThumbs: '⧉ Copy all thumbnails', stateOn: 'ON', stateOff: 'OFF', copied: 'Copied', copyFailed: 'Copy failed', topicRequired: 'Topic is required', pleaseWait: 'Please wait — processing', working: 'Working', formatting: 'Formatting', polishing: 'Polishing', almostReady: 'Almost ready', historyCleared: 'History cleared', confirmClear: 'Clear all saved generations? This cannot be undone.', requestFailed: 'Request failed.', audienceProfile: 'Audience Profile', titleLabel: 'Title', thumbnailLabel: 'Thumbnail', topPick: 'Top pick', clickToCopy: 'Click to copy', collapseExpand: 'Collapse/Expand', removeResult: 'Remove result', dismiss: 'Dismiss', languageMarker: 'English'
  },
  es: {
    videoTopic: 'Tema del video <span class="req" aria-hidden="true">*</span>', topicPlaceholder: '¿De qué trata el video?', format: 'Formato (opcional)', formatPlaceholder: 'Documental, Reseña, Investigación...', targetAudience: 'Audiencia objetivo (opcional)', audiencePlaceholder: 'Nicho, rango de edad, región...', componentsCount: 'Componentes y cantidad', titles: 'Títulos', thumbnailTexts: 'Textos de miniatura', countLabel: 'Cantidad (5–15)', send: 'Enviar', clearHistory: '🗑 Borrar historial', copyAllTitles: '⧉ Copiar todos los títulos', copyAllThumbs: '⧉ Copiar todas las miniaturas', stateOn: 'SÍ', stateOff: 'NO', copied: 'Copiado', copyFailed: 'Error al copiar', topicRequired: 'El tema es obligatorio', pleaseWait: 'Por favor espera — procesando', working: 'Trabajando', formatting: 'Formateando', polishing: 'Puliendo', almostReady: 'Casi listo', historyCleared: 'Historial borrado', confirmClear: '¿Borrar todas las generaciones guardadas? Esto no se puede deshacer.', requestFailed: 'Solicitud fallida.', audienceProfile: 'Perfil de audiencia', titleLabel: 'Título', thumbnailLabel: 'Miniatura', topPick: 'Mejor opción', clickToCopy: 'Clic para copiar', collapseExpand: 'Colapsar/Expandir', removeResult: 'Eliminar resultado', dismiss: 'Cerrar', languageMarker: 'Spanish/Español'
  },
  ru: {
    videoTopic: 'Тема видео <span class="req" aria-hidden="true">*</span>', topicPlaceholder: 'О чём видео?', format: 'Формат (необязательно)', formatPlaceholder: 'Документальный, Обзор, Расследование...', targetAudience: 'Целевая аудитория (необязательно)', audiencePlaceholder: 'Ниша, возраст, регион...', componentsCount: 'Компоненты и количество', titles: 'Заголовки', thumbnailTexts: 'Тексты превью', countLabel: 'Количество (5–15)', send: 'Отправить', clearHistory: '🗑 Очистить историю', copyAllTitles: '⧉ Копировать все заголовки', copyAllThumbs: '⧉ Копировать все превью', stateOn: 'ВКЛ', stateOff: 'ВЫКЛ', copied: 'Скопировано', copyFailed: 'Ошибка копирования', topicRequired: 'Тема обязательна', pleaseWait: 'Пожалуйста, подождите — обработка', working: 'Работаю', formatting: 'Форматирую', polishing: 'Дорабатываю', almostReady: 'Почти готово', historyCleared: 'История очищена', confirmClear: 'Очистить все сохранённые генерации? Это действие нельзя отменить.', requestFailed: 'Запрос не удался.', audienceProfile: 'Профиль аудитории', titleLabel: 'Заголовок', thumbnailLabel: 'Превью', topPick: 'Лучший вариант', clickToCopy: 'Нажмите для копирования', collapseExpand: 'Свернуть/Развернуть', removeResult: 'Удалить результат', dismiss: 'Закрыть', languageMarker: 'Russian/Русский'
  },
  uk: {
    videoTopic: 'Тема відео <span class="req" aria-hidden="true">*</span>', topicPlaceholder: 'Про що відео?', format: 'Формат (необов\'язково)', formatPlaceholder: 'Документальний, Огляд, Розслідування...', targetAudience: 'Цільова аудиторія (необов\'язково)', audiencePlaceholder: 'Ніша, вік, регіон...', componentsCount: 'Компоненти та кількість', titles: 'Заголовки', thumbnailTexts: 'Тексти прев\'ю', countLabel: 'Кількість (5–15)', send: 'Відправити', clearHistory: '🗑 Очистити історію', copyAllTitles: '⧉ Копіювати всі заголовки', copyAllThumbs: '⧉ Копіювати всі прев\'ю', stateOn: 'УВІМК', stateOff: 'ВИМК', copied: 'Скопійовано', copyFailed: 'Помилка копіювання', topicRequired: 'Тема обов\'язкова', pleaseWait: 'Будь ласка, зачекайте — обробка', working: 'Працюю', formatting: 'Форматую', polishing: 'Доопрацьовую', almostReady: 'Майже готово', historyCleared: 'Історію очищено', confirmClear: 'Очистити всі збережені генерації? Цю дію не можна скасувати.', requestFailed: 'Запит не вдався.', audienceProfile: 'Профіль аудиторії', titleLabel: 'Заголовок', thumbnailLabel: 'Прев\'ю', topPick: 'Найкращий варіант', clickToCopy: 'Натисніть для копіювання', collapseExpand: 'Згорнути/Розгорнути', removeResult: 'Видалити результат', dismiss: 'Закрити', languageMarker: 'Ukrainian/Українська'
  }
};
function detectLanguage() { const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase(); if (lang.startsWith('es')) return 'es'; if (lang.startsWith('ru')) return 'ru'; if (lang.startsWith('uk')) return 'uk'; return 'en'; }
let currentLang = detectLanguage(); let t = translations[currentLang];
function applyTranslations() { document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if (t[key]) { el.innerHTML = t[key]; } }); document.querySelectorAll('[data-i18n-placeholder]').forEach(el => { const key = el.getAttribute('data-i18n-placeholder'); if (t[key]) { el.placeholder = t[key]; } }); document.querySelectorAll('.state').forEach(el => { el.setAttribute('data-on', t.stateOn); el.setAttribute('data-off', t.stateOff); }); document.documentElement.lang = currentLang; }

/* ================= CONFIG ================= */
const API_KEY = "AIzaSyDkowFTxiuya3AKjX4yaoA4XaTEK13OXx8"; // IMPORTANT: Replace with your actual Gemini API Key
const MODEL     = "gemini-1.5-pro-latest";
const RETRIES = 5;
const BASE_DELAY = 800;

/* ================= SYSTEM PROMPT ================= */
const SYSTEM_PROMPT = `ROLE: You are an expert in viral YouTube titles & thumbnail texts. Your mission is to craft options that skyrocket CTR. IMPORTANT: You must respond in the same language as the user's input. KNOWLEDGE: Use curiosity, benefit, FOMO, surprise. Be specific (208% not 200%). Title + thumbnail should tell a 1-second story. Thumbnail text: 1-5 words, ≤50 chars, NO colons, complementary to title. METHODOLOGY: Analyze niche/audience, verify each option for emotional hook and clarity. LANGUAGE: MUST respond in the same language as user input. ==== HARD CONSTRAINTS & JSON OUTPUT CONTRACT ==== 1) STRICT JSON ONLY. No markdown, no commentary. Return ONE JSON object: {"audienceProfile": "STRING (3-6 sentences)","options": [{"title":"STRING","thumbnailText":"STRING"}],"topPicks": [{"index":INTEGER},{"index":INTEGER}]} 2) COUNT: Return exactly N options (N provided externally). 3) TITLES: ≤100 chars. 4) THUMBNAIL TEXTS: 1-5 words, ≤50 chars, NO colons ":". 5) TOP PICKS: Exactly two unique 1-based indexes. 6) RELIABILITY: Start output with "{" and end with "}".`;
function buildUserBlock({topic, format, audience, wantTitles, wantThumbs, count}){ const comp = wantTitles && wantThumbs ? "Titles & Thumbnail texts" : wantTitles ? "Titles only" : "Thumbnail texts only"; return [`VIDEO TOPIC: ${escapeForPrompt(topic)}`, `FORMAT: ${escapeForPrompt(format || "(not specified)")}`, `TARGET AUDIENCE: ${escapeForPrompt(audience || "(not specified)")}`, `LANGUAGE: auto-detect from topic (current interface language: ${t.languageMarker})`, `REQUESTED COMPONENTS: ${comp}`, `NUMBER OF VARIANTS: ${count}`, `OUTPUT REQUIREMENTS: • Return exactly ${count} options • Include Audience Profile • Include 2 Top Picks • Respond in the same language as topic text`].join("\n"); }
function responseSchema(){ return { type: "OBJECT", properties: { audienceProfile: { type: "STRING" }, options: { type: "ARRAY", items: { type: "OBJECT", properties: { title: { type: "STRING" }, thumbnailText: { type: "STRING" } }, required: ["title", "thumbnailText"] } }, topPicks: { type: "ARRAY", items: { type: "OBJECT", properties: { index: { type: "INTEGER" } }, required: ["index"] } } }, required: ["audienceProfile","options","topPicks"] }; }
const GENCFG_HQ = { temperature: 0.85, topP: 0.92, maxOutputTokens: 8192, responseMimeType: "application/json", responseSchema: responseSchema() };

/* ================= STORAGE ================= */
const store = { saveInputs(v){ localStorage.setItem("tc_inputs_v9", JSON.stringify(v)); }, loadInputs(){ try{ return JSON.parse(localStorage.getItem("tc_inputs_v9"))||{} }catch{ return {} } }, addSession(s){ const all = store.loadSessions(); all.unshift(s); localStorage.setItem("tc_sessions_v9", JSON.stringify(all)); }, loadSessions(){ try{ return JSON.parse(localStorage.getItem("tc_sessions_v9"))||[] }catch{ return [] } }, clearSessions(){ localStorage.setItem("tc_sessions_v9", JSON.stringify([])); }, deleteSession(id){ const all = store.loadSessions().filter(x => x.id !== id); localStorage.setItem("tc_sessions_v9", JSON.stringify(all)); } };

/* ================= UTILS ================= */
const $ = s => document.querySelector(s);
const clamp = (n,min,max)=> Math.max(min, Math.min(max, n));
const clampStr = (s,n)=> (s||"").trim().slice(0,n);
const MAX_CHARS_TOPIC=800, MAX_CHARS_FORMAT=300, MAX_CHARS_AUDIENCE=300;
const toast = (msg)=>{ const actualMsg = t[msg] || msg || t.copied; const el=$("#toast"); el.textContent=actualMsg; el.classList.add("show"); setTimeout(()=> el.classList.remove("show"), 1200) };
function escapeForPrompt(s){ return (s||"").replace(/[<>]/g, m => ({'<':'&lt;','>':'&gt;'}[m])) }
function joinParts(parts){ return (parts||[]).map(p=> p.text).filter(Boolean).join("") }
function truncate(s,n){ return s && s.length>n ? s.slice(0,n-1)+'…' : (s||"") }
function uid(){ return 's_'+Date.now().toString(36)+'_'+Math.random().toString(36).slice(2,7) }
function safeParseJSON(m){ if(!m) return null; try{ return JSON.parse(m) }catch{} const a=m.indexOf("{"), b=m.lastIndexOf("}"); if(a>=0&&b>a){ try{ return JSON.parse(m.slice(a,b+1)) }catch{} } return null }
// === UPGRADE: Haptic Feedback Function ===
function hapticFeedback() { if (navigator.vibrate) { navigator.vibrate(50); } }

/* ================= NORMALIZE OUTPUT ================= */
function normalizeOutput(o, opts){ const { wantTitles, wantThumbs, count } = opts; const options = (o.options||[]).slice(0, count).map(x=> ({ title: wantTitles ? (x.title||"").trim().slice(0,100) : "", thumbnailText: wantThumbs ? (x.thumbnailText||"").replace(/:/g,"").trim().slice(0,50) : "" })); while(options.length < count) options.push({ title: "", thumbnailText: "" }); const tp = Array.isArray(o.topPicks) ? o.topPicks.filter(v => Number.isInteger(v.index)).map(v => ({ index: clamp(parseInt(v.index,10)||1, 1, options.length) })).slice(0, 2) : []; return { audienceProfile: (o.audienceProfile||"").trim(), options, topPicks: tp }; }

/* ================= NETWORK ================= */
async function callGemini(payload, tries=RETRIES){ const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${encodeURIComponent(API_KEY)}`; let lastErr; for(let i=0;i<tries;i++){ try{ const res = await fetch(url, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) }); if(!res.ok){ const txt = await res.text().catch(()=> ""); throw new Error(`HTTP ${res.status}: ${txt||res.statusText}`) } return await res.json(); }catch(err){ lastErr = err; await new Promise(r => setTimeout(r, BASE_DELAY * Math.pow(2, i) + Math.random()*300)); } } throw lastErr; }

/* ================= RENDER ================= */
function rowHTML(i, opt, topSet, showTitle, showThumb){ const n = i+1; const isTop = topSet.has(n); const titleVal = opt.title || ''; const thumbVal = opt.thumbnailText || ''; const titleHTML = showTitle && titleVal ? `<div class="line"><div class="label">${t.titleLabel}</div><div class="txt" data-kind="title" role="button" tabindex="0" title="${t.clickToCopy}">${titleVal}</div></div>` : ''; const thumbHTML = showThumb && thumbVal ? `<div class="line"><div class="label">${t.thumbnailLabel}</div><div class="txt" data-kind="thumb" role="button" tabindex="0" title="${t.clickToCopy}">${thumbVal}</div></div>` : ''; if (!titleHTML && !thumbHTML) return ''; return `<div class="row${isTop? ' top':''}" data-idx="${n}"><div class="badge" aria-hidden="true">${n}</div>${isTop? `<span class="star" aria-label="${t.topPick}" title="${t.topPick}">★</span>`:''}<div class="pair">${titleHTML}${thumbHTML}</div></div>`; }
function sessionHTML(session){ const { output, view } = session; const topSet = new Set((output.topPicks||[]).map(x=> x.index)); const list = (output.options||[]).map((o,i)=> rowHTML(i,o,topSet,view.wantTitles,view.wantThumbs)).filter(Boolean).join(''); return `<article class="session" role="region" aria-label="Result session" data-id="${session.id}"><div class="session-head"><button class="iconbtn collapse" title="${t.collapseExpand}"><svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5H7z"/></svg></button><button class="iconbtn close" title="${t.removeResult}"><svg viewBox="0 0 24 24"><path d="M18.3 5.71L12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"/></svg></button></div><div class="audience" data-label="${t.audienceProfile}">${output.audienceProfile||''}</div><div class="list">${list}</div></article>`; }
function skeletonCard(){ const wrap = document.createElement('div'); wrap.className = 'session'; wrap.innerHTML = `<div class="session-head"><button class="iconbtn sk-close" title="${t.dismiss}"><svg viewBox="0 0 24 24"><path d="M18.3 5.71L12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"/></svg></button></div><div class="skeleton"><div class="pulse"></div><div class="pulse"></div><div class="pulse"></div></div>`; return wrap; }
function animateResultsIn(sessionCard) { const audienceCard = sessionCard.querySelector('.audience'); const resultRows = sessionCard.querySelectorAll('.row'); if (audienceCard) { setTimeout(() => { audienceCard.classList.add('visible'); }, 100); } resultRows.forEach((row, index) => { setTimeout(() => { row.classList.add('visible'); }, 250 + index * 80); }); }

/* ================= COPY / CONTROLS ================= */
function attachCopyHandlers(scope=document){ function copyText(el){ const text = el?.textContent?.trim() || ''; if(!text) return; navigator.clipboard.writeText(text).then(()=>{ hapticFeedback(); el.style.boxShadow = '0 0 0 3px rgba(110,231,255,.35) inset'; setTimeout(()=>{ el.style.boxShadow = ''; }, 450); toast('copied'); }).catch(()=> toast('copyFailed')); } scope.querySelectorAll('.txt').forEach(el=>{ el.addEventListener('click', ()=> copyText(el)); el.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); copyText(el); }}); }); }
function attachSessionControls(scope=document){ scope.querySelectorAll('.session .collapse, .session .close').forEach(btn => btn.addEventListener('click', hapticFeedback)); scope.querySelectorAll('.session .collapse').forEach(btn=>{ btn.onclick = () => { const card = btn.closest('.session'); card.classList.toggle('collapsed'); const path = btn.querySelector('path'); path.setAttribute('d', card.classList.contains('collapsed') ? 'M7 14l5-5 5 5H7z' : 'M7 10l5 5 5-5H7z'); }; }); scope.querySelectorAll('.session .close').forEach(btn=>{ btn.onclick = () => { const card = btn.closest('.session'); const id = card?.dataset?.id; card.style.transform='scale(.98)'; card.style.opacity='.0'; setTimeout(()=>{ card.remove(); if(id) store.deleteSession(id); }, 180); }; }); scope.querySelectorAll('.sk-close').forEach(btn=>{ btn.onclick = () => { btn.closest('.session')?.remove(); }; }); }
function collapseAllSessions(){ document.querySelectorAll('.session:not(.collapsed)').forEach(el=>{ el.classList.add('collapsed'); const chevron = el.querySelector('.collapse path'); if(chevron) chevron.setAttribute('d','M7 14l5-5 5 5H7z'); }); }

/* ================= FLOW ================= */
function clampCountInput(){ const el = $("#count"); let val = parseInt(el.value||"10",10); if(isNaN(val)) val = 10; el.value = String(clamp(val, 5, 15)); }
let btnMsgTimer=null;
function setBtnBusy(btn, on){ if(on){ btn.setAttribute('aria-busy','true'); btn.disabled=true; const msgs = [t.working, t.formatting, t.polishing, t.almostReady]; let i=0; btn.querySelector('.btn-text').innerHTML = `${msgs[i]}<span class="dots"></span>`; clearInterval(btnMsgTimer); btnMsgTimer = setInterval(()=>{ i=(i+1)%msgs.length; btn.querySelector('.btn-text').innerHTML = `${msgs[i]}<span class="dots"></span>`; }, 1400); }else{ btn.setAttribute('aria-busy','false'); btn.disabled=false; clearInterval(btnMsgTimer); btnMsgTimer=null; btn.querySelector('.btn-text').textContent = t.send; } }

async function generate(){
  const btn = $("#send");
  if(btn.getAttribute('aria-busy')==='true'){ toast('pleaseWait'); return; }

  const topic = clampStr($("#topic").value, MAX_CHARS_TOPIC);
  if(!topic){ $("#topic").focus(); toast("topicRequired"); return; }
  if (API_KEY === "YOUR_API_KEY") { toast("Please set your API_KEY in the script."); return; }

  hapticFeedback();
  const format = clampStr($("#format").value, MAX_CHARS_FORMAT);
  const audience = clampStr($("#audience").value, MAX_CHARS_AUDIENCE);
  let wantTitles = $("#wantTitles").checked, wantThumbs = $("#wantThumbs").checked;
  clampCountInput();
  let count = clamp(parseInt($("#count").value||"10",10)||10, 5, 15);
  if(!wantTitles && !wantThumbs) wantTitles = true;

  store.saveInputs({topic, format, audience, wantTitles, wantThumbs, count});
  setBtnBusy(btn, true);
  blinkFields();
  collapseAllSessions();

  const stream = $("#stream"); const skel = skeletonCard(); stream.prepend(skel);

  const payload = { systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] }, contents: [{ role: "user", parts: [{ text: buildUserBlock({topic, format, audience, wantTitles, wantThumbs, count}) }] }], generationConfig: GENCFG_HQ };
  try{
    const json = await callGemini(payload);
    const first = (json.candidates||[])[0];
    const text = joinParts(first?.content?.parts);
    const parsed = safeParseJSON(text);
    if(!parsed || !Array.isArray(parsed.options)) throw new Error('Invalid model response');

    const normalized = normalizeOutput(parsed, { wantTitles, wantThumbs, count });
    const session = { id: uid(), createdAt: new Date().toISOString(), input:{topic,format,audience}, view:{ wantTitles, wantThumbs, count }, output: normalized };
    store.addSession(session);

    const cardWrap = document.createElement('div'); cardWrap.innerHTML = sessionHTML(session);
    const sessionCard = cardWrap.firstElementChild;
    
    stream.replaceChild(sessionCard, skel);
    attachCopyHandlers(sessionCard);
    attachSessionControls(sessionCard);
    animateResultsIn(sessionCard);

    // === UPGRADE: Scroll to results on mobile ===
    if (window.innerWidth < 960) {
      setTimeout(() => {
        $("#results-panel").scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 200);
    }
  }catch(err){
    const message = err?.message||'Unknown error';
    skel.innerHTML = `<div class="session-head"><button class="iconbtn sk-close" title="${t.dismiss}"><svg viewBox="0 0 24 24"><path d="M18.3 5.71L12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"/></svg></button></div><div class="skeleton" role="alert" style="border:1px solid #3e2c2c; background:#1a0f12; color:#ffc7c7"><strong>${t.requestFailed}</strong> ${truncate(message,260)}</div>`;
    attachSessionControls(skel);
  }finally{
    setBtnBusy(btn,false);
  }
}

/* ================= INIT ================= */
function renderAll(){
  const container = $("#stream"); container.innerHTML = "";
  store.loadSessions().forEach(s => {
    const wrap = document.createElement("div"); wrap.innerHTML = sessionHTML(s);
    wrap.querySelectorAll('.audience, .row').forEach(el => el.classList.add('visible'));
    container.appendChild(wrap.firstElementChild);
  });
  attachCopyHandlers(container);
  attachSessionControls(container);
}
function bindUI(){
  applyTranslations();
  setTimeout(()=> { $("#pageloader")?.classList.add('hidden'); $("#appRoot")?.removeAttribute('aria-hidden'); }, 1840);

  const inputs = store.loadInputs();
  if(inputs.topic) $("#topic").value=inputs.topic;
  if(inputs.format) $("#format").value=inputs.format;
  if(inputs.audience) $("#audience").value=inputs.audience;
  if(typeof inputs.wantTitles==="boolean") $("#wantTitles").checked=inputs.wantTitles;
  if(typeof inputs.wantThumbs==="boolean") $("#wantThumbs").checked=inputs.wantThumbs;
  if(inputs.count) $("#count").value = clamp(parseInt(inputs.count,10)||10, 5, 15);

  const countEl = $("#count");
  countEl.addEventListener('input', clampCountInput);
  countEl.addEventListener('blur', clampCountInput);

  $("#send").addEventListener("click", generate);
  document.addEventListener("keydown", (e)=>{ if(e.key==='Enter' && (e.ctrlKey || e.metaKey)){ generate(); } });
  
  const toolButtons = [$("#clear-history"), $("#copy-all-titles"), $("#copy-all-thumbs")];
  toolButtons.forEach(btn => btn.addEventListener("click", hapticFeedback));

  $("#clear-history").addEventListener("click", ()=>{ if(confirm(t.confirmClear)){ store.clearSessions(); renderAll(); toast("historyCleared"); } });
  $("#copy-all-titles").addEventListener("click", ()=>{ const items = [...document.querySelectorAll('.txt[data-kind="title"]')].map(n=> n.textContent.trim()).filter(Boolean).join("\n"); if(items) navigator.clipboard.writeText(items).then(()=> toast("copied")).catch(()=> toast("copyFailed")); });
  $("#copy-all-thumbs").addEventListener("click", ()=>{ const items = [...document.querySelectorAll('.txt[data-kind="thumb"]')].map(n=> n.textContent.trim()).filter(Boolean).join("\n"); if(items) navigator.clipboard.writeText(items).then(()=> toast("copied")).catch(()=> toast("copyFailed")); });
  
  const isDesktop = window.matchMedia("(hover: hover) and (pointer: fine)").matches;
  if (isDesktop) {
    const panels = document.querySelectorAll('.panel');
    document.body.addEventListener('mousemove', e => {
      const { clientX, clientY } = e;
      const { innerWidth, innerHeight } = window;
      document.documentElement.style.setProperty('--mouse-x', `${clientX}px`);
      document.documentElement.style.setProperty('--mouse-y', `${clientY}px`);
      const x = (clientX - innerWidth / 2) / innerWidth;
      const y = (clientY - innerHeight / 2) / innerHeight;
      panels.forEach(p => { p.style.transform = `rotateY(${x * 4}deg) rotateX(${-y * 4}deg)`; });
    });
  }
  renderAll();
}
bindUI();
</script>
</body>
</html>
